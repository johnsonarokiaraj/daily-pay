<table class="table">
  <tr>
    <td class="col-md-2"><h3 class="title"><span class="fa fa-area-chart"></span> Reports</h3></td>
    <td class="col-md-10">
      <div class="msg">
        <% if flash[:alert].present? %>
          <div class="alert alert-danger"><%= flash[:alert] %></div>
        <% end %>
        <% if flash[:notice].present? %>
          <div class="alert alert-success"><%= flash[:notice] %></div>
        <% end %>
      </div>
    </td>
  </tr>
</table>

<div class="row">
  <div class="col-md-12">
    <table class="table table-striped table-bordered">
      <%= form_with model: @closures, url: closures_path, html: { id: "closure-form" } do |f| %>
      <tr>
        <td class="col-md-3"><label>Start date</label><%= f.text_field :start_date, value: "", class: "form-control datepicker month-start-date"%></td>
        <td class="col-md-3"><label>End date</label><%= f.text_field :end_date, value: "", class: "form-control datepicker month-end-date"%></td>
        <td class="col-md-1"><button type="submit" class="btn btn-primary table-btn">Update</button></td>
      </tr>
      <% end %>
    </table>
    <div style="width: 100%;"><canvas id="payment_source"></canvas></div>
  </div>
</div>

<script>
    $(document).ready(function() {
        // Payment source
        (async function() {
            const data = <%= @tag_amounts.to_json.html_safe %>
            const backgroundColors = data.map((_, i) => `hsl(${i * 17 % 360}, 70%, 80%)`);
            const borderColors = data.map((_, i) => `hsl(${i * 17 % 360}, 70%, 50%)`);

            new Chart(
                document.getElementById('payment_source'),
                {
                    type: 'bar',
                    data: {
                        labels: data.map(row => row.key),
                        datasets: [
                            {
                                label: 'Report by tags',
                                data: data.map(row => row.value),
                                backgroundColor: backgroundColors,
                                borderColor: borderColors,
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y', // this flips the chart to horizontal
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }
                }
            );
        })();

    });
</script>
