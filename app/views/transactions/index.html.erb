<table class="table">
  <tr>
    <td class="col-md-2">
      <h3 class="title">
        <span class="fa fa-list-alt"></span>
        Transactions
        <span class="badge badge-light"><%= @transactions.count %></span>
      </h3>
    </td>
    <td class="col-md-10">
      <div class="msg">
        <% if flash[:alert].present? %>
          <div class="alert alert-danger"><%= flash[:alert] %></div>
        <% end %>
        <% if flash[:notice].present? %>
          <div class="alert alert-success"><%= flash[:notice] %></div>
        <% end %>
      </div>
    </td>
  </tr>
</table>

<table class="table table-striped table-bordered">
  <%= form_with model: @transactions, url: transactions_path, remote: true, html: { id: "transaction-form", class: "tag-form" } do |f| %>
    <tr>
      <td class="col-md-2">
        <label>Date</label>
        <%= f.text_field :transaction_date, value: "", class: "form-control datepicker date" %>
        <a href="#" class="date-link set-today">today</a><a class="date-link set-yesterday" href="#">yesterday</a>
      </td>
      <td class="col-md-2"><label>Name</label><%= f.text_field :name, placeholder: "Enter the name", value: "", class: "form-control" %></td>
      <td class="col-md-1"><label>Amount</label><%= f.text_field :amount, placeholder: "amount", value: "", class: "form-control" %></td>
      <td class="col-md-6"><label>Tags</label><%= f.text_field :tag_list, placeholder: "type tags", value: "", class: "form-control tag", data: { tags: @tag_names.to_json } %></td>
      <td class="col-md-3"><button type="submit" class="btn btn-primary table-btn">Add</button></td>
    </tr>
  <% end %>
</table>


<div class="row" style="margin-bottom: 20px;">
  <div class="col-md-9"></div>
  <div class="col-md-3">
    <div class="row">
      <%= form_with model: @transactions, url: transactions_path, remote: true, html: { id: "transaction-form", class: "tag-form w-100" } do |f| %>
        <div class="col-md-8">
            <%= f.select :name, options_for_select(@closure_options), { prompt: "Select a name" }, class: "form-control" %>
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-primary w-100">Apply</button>
        </div>
      <% end %>
    </div>
  </div>
</div>


<table class="table table-striped table-bordered">
  <% if @transactions.present? %>
    <thead>
    <tr>
      <th class="col-md-1">Date</th>
      <th class="col-md-3">Name</th>
      <th class="col-md-2">Amount <span class="badge badge-danger" style="color: #fff;background-color: #dc3545"><%= @total %></span></th>
      <th>Tags</th>
      <th class="col-md-1" >&nbsp;</th>
    </tr>
    </thead>
    <tbody>
    <% @transactions.each do |transaction| %>
      <tr>
        <td><%= format_date(transaction.transaction_date) %></td>
        <td><%= transaction.name %></td>
        <td><%= transaction.amount %></td>
        <td>
          <%- transaction.tag_list.each do |tag| %>
            <span class="tag-1 badge rounded-pill bg-light text-dark"><%= tag %></span>
          <% end %>
        </td>
        <td>
          <a href="#" class="fa fa-pencil-square-o edit" title="Edit" data-toggle="modal" data-target="#edit_modal" data-id="<%= transaction.id %>"></a>
          <a href="#" class="fa fa-lightbulb-o delete" title="<%= transaction.id %>"></a>
        </td>
      </tr>
    <% end %>
    </tbody>
  <% else %>
    <tr>
      <td colspan="3" class="text-center alert alert-info">No transactions are available to display</td>
    </tr>
  <% end %>
</table>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const filterIcon = document.getElementById("filter-icon");
        const filterTable = document.getElementById("filter-table");

        filterIcon.addEventListener("click", function (e) {
            e.preventDefault();
            if (filterTable.style.display === "none") {
                filterTable.style.display = "block";
            } else {
                filterTable.style.display = "none";
            }
        });
    });

</script>